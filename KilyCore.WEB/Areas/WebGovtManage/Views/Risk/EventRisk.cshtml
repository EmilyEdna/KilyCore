
@{
    ViewData["Title"] = "事件分布图";
    Layout = "~/Views/Shared/BaseView.cshtml";
}
@section css{
    <style>
        .ibox {
            width: 100%;
            height: 100%;
            border: #ccc solid 1px;
            margin: auto auto;
        }
        label {
        max-width:80px;
        }
    </style>
}
@section script{
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=rEU7BdGnB0kKyIjUiONnUHlw"></script>
    <script>
        //配置
        var options = {
            Init: function () {
                this.InitDom();
                this.InitEvents();
            },
            //元素
            InitDom: function () {
                options.Name = null;
                controller.ajax({
                    url: "GovtWeb/GetCity",
                    data: { Id: GovtInfo.City },
                    async: false,
                    type: "post",
                    success: function (result) {
                        options.Name = result.data;
                    }
                });
                $.ajax({
                    url: "http://api.map.baidu.com/geocoder/v2/?address=" + options.Name + "&output=json&ak=rEU7BdGnB0kKyIjUiONnUHlw",
                    type: "get",
                    async: false,
                    dataType: "jsonp",
                    success: function (result) {
                        options.marker = new BMap.Marker(new BMap.Point(result.result.location.lng, result.result.location.lat));
                        options.Map.addOverlay(options.marker);               // 将标注添加到地图中
                        controller.ajax({
                            url: "GovtWeb/GetRiskCount",
                            data: {},
                            async: false,
                            type: "post",
                            success: function (result) {
                                var label = new BMap.Label(options.Name + "(" + result.data + "条)", { offset: new BMap.Size(20, -15) });
                                label.setStyle({
                                    width: "80px",
                                    background: '#ff8355',
                                    border: '1px solid "#ff8355"',
                                    borderRadius: "5px",
                                    textAlign: "center",
                                    height: "26px",
                                    lineHeight: "26px"
                                });
                                options.marker.setLabel(label);
                            }
                        });
                    }
                });
                options.Map = new BMap.Map("Map");//在百度地图容器中创建一个地图
                options.Map.centerAndZoom(options.Name, 11);//设定地图的中心点和坐标并将地图显示在地图容器中
                options.Map.enableScrollWheelZoom();//启用地图滚轮放大缩小
            },
            //事件
            InitEvents: function () {
                $(".BMapLabel").css("width", "20px");
            }
        };
        //初始化
        $(document).ready(function () {
            options.Init();
        });
    </script>
}
<div class="ibox" id="Map"></div>

@{
    ViewData["Title"] = "单位食堂详情";
    Layout = "~/Views/Shared/BaseView.cshtml";
}
@section css{ 
   <style>
      label{font-weight:normal;}
      ul,li{margin:0px 0px;padding:0px 0px;}
      .imgbox img{max-width:100%}
    .cx_health{width:100%;margin:0 auto;overflow:hidden;margin-top:30px}
    .cx_health>div{float:left;width:25%;margin-bottom:30px;border:1px solid #eaeff5;margin-right:14px;height:313px;box-shadow:3px 2px 8px #f1f2f4}
    .cx_health>div:nth-child(2n){margin-right:20px}
    .cx_health>div ul:nth-child(1){height:238px;overflow:hidden}
    .cx_health>div ul:nth-child(1) li{height:238px;display:flex;justify-content:center;align-items:center}
    .cx_health>div ul:nth-child(1) li img{max-width:100%;max-height:100%}
    .cx_health>div ul:nth-child(2){width:376px;margin:0 auto;overflow:hidden;border-bottom:1px solid #eaeff5;text-align:center;padding-bottom:10px}
    .cx_health>div ul:nth-child(2) span{display:inline-block;width:47px;height:20px;background:#21bead;color:#fff;font-size:14px;border-radius:3px;margin-left:20px}
    .cx_health>div ul:nth-child(3){overflow:hidden;line-height:43px;width:303px;margin:0 auto;overflow:hidden}
    .cx_health>div ul:nth-child(3) span{display:block;float:right;font-size:14px;color:#000}
    .cx_ingredients{width:100%;margin:0 auto;overflow:hidden}
.cx_ingredients1{overflow:hidden;position:relative;height:56px;margin-top:13px;border-bottom:1px solid #eaeff5}
.cx_ingredients1 ul:nth-child(1){position:absolute;left:0;top:0}
.cx_ingredients1 ul:nth-child(2){text-align:center;line-height:56px;margin-right:40px}
.cx_ingredients1 ul:nth-child(2) a{display:inline-block;height:55px;text-align:center;padding-right:0;width:54px}
.cx_ingredients1 ul:nth-child(2) a.on{border-bottom:2px solid #1fb7c4;text-align:center}
.cx_ingredients1 ul:nth-child(3){position:absolute;top:0;right:0;cursor:pointer}
.cx_ingredients1 ul:nth-child(1) li:nth-child(1){height:56px;display:flex;justify-content:center;align-items:center;float:left}
.cx_ingredients1 ul:nth-child(1) li:nth-child(2){line-height:56px;float:left;margin-left:10px;font-size:20px;color:#000}
.cx_ingredients1 ul:nth-child(3) li{float:left;height:56px;display:flex;justify-content:center;align-items:center;font-size:14px;color:#858585}
.cx_ingredients2{overflow:hidden;margin-bottom:60px}
.cx_ingredients2>div{overflow:hidden;margin-top:10px}
.cx_ingredients2>div>div:nth-child(1){overflow:hidden;height:64px;overflow:hidden}
.cx_ingredients2>div>div:nth-child(1) ul li{float:left;margin-right:10px}
.cx_ingredients2>div>div:nth-child(1) ul li:nth-child(1){height:64px;display:flex;justify-content:center;align-items:center}
.cx_ingredients2>div>div:nth-child(1) ul li:nth-child(2){line-height:64px;font-size:16px;color:#000}
.cx_ingredients2>div>div:nth-child(2){overflow:hidden}
.cx_ingredients2>div>div:nth-child(2)>div{float:left;width:397px;margin-bottom:6px;overflow:hidden;transition:all .5s ease 0s;-moz-transition:all .5s ease 0s;-ms-transition:all .5s ease 0s;-o-transition:all .5s ease 0s;-webkit-transition:all .5s ease 0s}
.cx_ingredients2>div>div:nth-child(2)>div:nth-child(2n){float:right;margin-right:3px}
.cx_ingredients2>div>div:nth-child(2)>div:hover{box-shadow:3px 3px 3px #eaeff3}
pre{font-family:'微软雅黑'}
.box{width:800px;background-color:#fff;position:relative;margin-left:0px;}
.box a{padding-right:20px}
   </style>
}
@section script{
    <script>
        //配置
        var options = {
            Init: function () {
                this.InitDom();
                this.InitEvents();
            },
            //元素
            InitDom: function () {
                //取详情
                controller.ajax({
                    url: "GovtWeb/GetRepastDetail",
                    data: { Id: controller.GetParam("Id") },
                    async: false,
                    type: "post",
                    success: function (result) {
                        //controller.SetCtrlValue("#Edit", result.data);
                        controller.SetLableValue("#Edit", result.data);
                        
                        $.each(result.data.Video, function (i,obj) {
                             var url = "/StaticHtml/PlayVedio.html?addr=" + obj.VideoAddress+"&cover="+obj.CoverPhoto;
                           $(".J_iframe").eq(i).attr("src", url);

                        })                       
                        options.BindHonor(result.data.HonorCertification);
                        options.BindHealth(result.data.Id);
                        options.BindThing(result.data.Id);
                    }
                });
                //查看大图
                $("#tab-2,#tab-3").find("img").on('click', function () {
                    var option = {
                        title: "相关证书",
                        data: [{
                            alt: "相关证书",
                            src: $(this).attr("src")
                        }]
                    };
                    controller.Photos(option);
                });
            },
            //绑定荣誉证书
            BindHonor: function (data) {
                if (data != null) {
                    var html = '';
                    $.each(data, function (i, obj) {
                        html += '<img src="' + obj + '" class="img-preview-sm" title="点击放大"/>';
                    });
                    $("#tab-3").find(".ibox-content").html(html);
                    if (data.length > 4)
                        $("#tab-3").find(".ibox-content").find("img").css({ width: "184px", padding: "1px" });
                    else
                        $("#tab-3").find(".ibox-content").find("img").css({ width: "186px", padding: "1px" });
                }
            },
            //健康证
            BindHealth: function (data) {
                controller.ajax({
                    url: "Temp/GetAllUser",
                    data: { Id: data},
                    async: false,
                    success: function (res) {
                        var HealthHTML = "";
                        $.each(res.data, function (i, item) {
                            HealthHTML += '<div class="imgbox">'
                                + '<ul>'
                                + '<li><img src="http://system.cfda.vip'+ item.HealthImg + '" class="smallimgo" alt=""></li>'
                                + ' </ul>'
                                + '<ul>'
                                + ' <li style="margin-top:6px;">'
                                + '<lable>' + item.PersonName + '</lable>'
                                + ' <span>' + item.JobStatus + '</span>'
                                + ' </li>'
                                + '</ul>'
                                + '<ul>'
                                + ' <li>'
                                + '<span>有效期: ' + item.TimeLength + '</span>'
                                + '</li>'
                                + '</ul>'
                                + '</div>';

                        });
                        $("#CompanyHealth").append(HealthHTML);
                    }
                });
            },
            //食材供应
            BindThing: function (data) {
                controller.ajax({
                    url: "Temp/RepastThing",
                    data: { Id: data},
                    async: false,
                    success: function (res) {
                       var ThingHTML = "";
                        $.each(res.data, function (i, item) {
                            ThingHTML += '<div class="cx_ingredients2">'
                                + '<div>'
                                + ' <div>'
                                + ' <ul>'
                                + ' <li><img src="http://www.cfda.vip/web/images/fgsag12f.png" alt="" /></li>'
                                + ' <li>' + item.ThingName + '</li>'
                                + '</ul>'
                                + ' </div>'
                                + '<div>'
                                + ' <div class="imgbox" style="width:100%;float:none;">'
                                + ' <ul>'
                                + '<li>' + item.Remark.replace("<img", "<img class='smallimg'") + '</li>'
                                + '</ul>'
                                + '</div>'
                                + '</div>'
                                + '</div>'
                                + '</div>';

                        });
                        $("#CompanyThing").append(ThingHTML);
                    }
                });
            },
            //事件
            InitEvents: function () {
                $("#four").click(function () {
                    $("#play").contents().find(".vcp-player").css("margin", "0 auto");
                });
            },
        };
        //初始化
        $(document).ready(function () {
            options.Init();
        });

    </script>
}
<form class="form-horizontal" method="post" id="Edit">
    <div class="tabs-container">
        <ul class="nav nav-tabs" style="margin-top:12px;">
            <li class="active">
                <a data-toggle="tab" href="#tab-1" aria-expanded="true"> 基本信息</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-2" aria-expanded="false">营业执照</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-3" aria-expanded="false">荣誉证书</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-4" aria-expanded="false" id="four">视频监控</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-5" aria-expanded="false">人员管理</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-6" aria-expanded="false">食材供应</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-7" aria-expanded="false">周菜谱</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-8" aria-expanded="false">废物处理</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-9" aria-expanded="false">留样管理</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-10" aria-expanded="false">抽检信息</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-11" aria-expanded="false">陪餐打卡</a>
            </li>
            <li>
                <a data-toggle="tab" href="#tab-12" aria-expanded="false">自查记录</a>
            </li>
        </ul>
        <div class="tab-content">
            <div id="tab-1" class="tab-pane active">
                <table class="table table-hover table-bordered m-t-sm">
                    <colgroup>
                        <col width="120" />
                        <col width="40%" />
                        <col width="120" />
                        <col />
                    </colgroup>
                    <tr>
                        <th style="text-align:center"><label class="control-label">单位名称</label></th>
                        <td class="has-warning">
                            <label type="txt" name="MerchantName"></label>
                        </td>
                        <th style="text-align:center"><label class="control-label">所属行业</label></th>
                        <td class="has-warning">
                            <label type="txt" name="DiningTypeName"></label>
                        </td>
                    </tr>
                    <tr>
                        <th style="text-align:center"><label class="control-label">单位邮箱</label></th>
                        <td class="has-warning">
                            <label type="txt" name="Email"></label>
                        </td>
                        <th style="text-align:center"><label class="control-label">信用代码</label></th>
                        <td class="has-warning">
                            <label type="txt" name="CommunityCode"></label>
                        </td>
                    </tr>
                    <tr>
                        <th style="text-align:center"><label class="control-label">单位电话</label></th>
                        <td class="has-warning">
                            <label type="txt" name="Phone"></label>
                        </td>
                        <th style="text-align:center"><label class="control-label">所属单位</label></th>
                        <td class="has-warning">
                            <label type="txt" name="AllowUnit"></label>
                        </td>
                    </tr>
                    <tr>
                        <th style="text-align:center"><label class="control-label">单位地址</label></th>
                        <td class="has-warning" colspan="3">
                            <label type="txt" name="Address"></label>
                        </td>
                    </tr>
                    <tr>
                        <th style="text-align:center"><label class="control-label">单位介绍</label></th>
                        <td class="has-warning" colspan="3">
                            <label type="txt" name="Remark"></label>
                        </td>
                    </tr>
                </table>
            </div>
            <div id="tab-2" class="tab-pane">
                <div class="ibox-content">
                    <img class="img-preview" src="" type="image" name="Certification" style="display:block;margin:auto" title="点击放大" />
                </div>
            </div>
            <div id="tab-3" class="tab-pane">
                <div class="ibox-content">
                </div>
            </div>
            <!--监控视频-->
            <div id="tab-4" class="tab-pane">
                <div class="ibox-content">
                    <table style="width:1060px">
                        <tr>
                            <td style="text-align:center;"><iframe id="play" class="J_iframe" src="" name="iframe" style="width:87%;height:400px;margin:auto auto;" frameborder="0" seamless scrolling="no" align="middle"></iframe></td>
                            <td style="text-align:center;"><iframe id="play" class="J_iframe" src="" name="iframe" style="width:87%;height:400px;margin:auto auto;" frameborder="0" seamless scrolling="no" align="middle"></iframe></td>
                        </tr>
                        <tr>
                            <td style="text-align:center;"><iframe id="play" class="J_iframe" src="" name="iframe" style="width:87%;height:400px;margin:auto auto;" frameborder="0" seamless scrolling="no" align="middle"></iframe></td>
                            <td style="text-align:center;"><iframe id="play" class="J_iframe" src="" name="iframe" style="width:87%;height:400px;margin:auto auto;" frameborder="0" seamless scrolling="no" align="middle"></iframe></td>
                        </tr>
                    </table>
                </div>
            </div>
            <!--人员管理-->
            <div id="tab-5" class="tab-pane">
                <div class="ibox-content">
                    <table id="tableList" class="table">
                        <thead>
                            <tr>
                                <th data-field="TrueName" data-halign="center" data-align="center" data-valign="middle">姓名</th>
                                <th data-field="Phone" data-halign="center" data-align="center" data-valign="middle">入职状态</th>
                                <th data-field="ExpiredTime" data-halign="center" data-align="center" data-valign="middle">有效期</th>
                                <th data-halign="center" data-align="center" data-valign="middle">健康证</th>
                            </tr>
                        </thead>
                        <tbody id="PersonList">
                        </tbody>
                    </table>
                </div>
            </div>
            <!--食材供应-->
            <div id="tab-6" class="tab-pane">
                <div class="ibox-content">
                    <table id="tableList" class="table">
                        <thead>
                            <tr>
                                <th data-field="Theme" data-halign="center" data-align="center" data-valign="middle">台账名称</th>
                                <th data-field="UpTime" data-halign="center" data-align="center" data-valign="middle">上报时间</th>
                                <th data-field="Content" data-halign="center" data-align="center" data-valign="middle">凭证</th>
                            </tr>
                        </thead>
                        <tbody id="ThingList">
                        </tbody>
                    </table>
                </div>
            </div>
            <!--主营菜品-->
            <div id="tab-7" class="tab-pane">
                <div class="ibox-content">
                </div>
            </div>
            <!--废物处理-->
            <div id="tab-8" class="tab-pane">
                <div class="ibox-content">
                    <table id="tableList" class="table">
                        <thead>
                            <tr>
                                <th data-field="HandleWays" data-halign="center" data-align="center" data-valign="middle">处理方式</th>
                                <th data-field="Phone" data-halign="center" data-align="center" data-valign="middle">电话</th>
                                <th data-field="HandleTime" data-halign="center" data-align="center" data-valign="middle">处理时间</th>
                                <th data-field="HandleUser" data-halign="center" data-align="center" data-valign="middle">操作人</th>
                                <th data-halign="center" data-align="center" data-valign="middle">现场图片</th>
                            </tr>
                        </thead>
                        <tbody id="BadList">
                        </tbody>
                    </table>
                </div>
            </div>
            <!--留样管理-->
            <div id="tab-9" class="tab-pane">
                <div class="ibox-content">
                    <table id="tableList" class="table">
                        <thead>
                            <tr>
                                <th data-field="DishName" data-halign="center" data-align="center" data-valign="middle">菜品名称</th>
                                <th data-field="Phone" data-halign="center" data-align="center" data-valign="middle">储藏方式</th>
                                <th data-field="OperatUser" data-halign="center" data-align="center" data-valign="middle">操作人</th>
                                <th data-field="SampleTime" data-halign="center" data-align="center" data-valign="middle">留样时间</th>
                                <th data-halign="center" data-align="center" data-valign="middle">留样图片</th>
                            </tr>
                        </thead>
                        <tbody id="TempList">
                        </tbody>
                    </table>
                </div>
            </div>
            <!--抽检信息-->
            <div id="tab-10" class="tab-pane">
                <div class="ibox-content">
                </div>
            </div>
            <!--陪餐打卡-->
            <div id="tab-11" class="tab-pane">
                <div class="ibox-content">
                </div>
            </div>
            <!--企业自查-->
            <div id="tab-12" class="tab-pane">
                <div class="ibox-content">
                </div>
            </div>
        </div>
    </div>

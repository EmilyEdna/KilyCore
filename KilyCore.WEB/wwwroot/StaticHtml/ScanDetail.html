<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>商品详情</title>
    <link rel="icon" type="image/x-icon" href="StaticImg/logo.ico" />
    <link href="../Content/BootStrap/Css/bootstrap.css" rel="stylesheet" />
    <link href="Style/ScanDetail.css" rel="stylesheet" />
    <script src="../Content/JavaScript/jquery.min.js"></script>
    <script src="../Content/BootStrap/Script/bootstrap.js"></script>
    <script src="../Content/Layer/layer.js"></script>
    <script src="http://api.map.baidu.com/api?v=2.0&ak=rEU7BdGnB0kKyIjUiONnUHlw"></script>
    <script src="http://pv.sohu.com/cityjson?ie=utf-8"></script>
</head>
<body>
    <div class="row">
        <div class=" col-sm-12 col-xs-12 head">
            <img src="Style/ScanDetailImg/Logo.png" class="pull-left">
            <h1>中食药监管信息查询平台</h1>
        </div>
    </div>
    <div class="row">
        <div class="content">
            <div class="panel panel-default">
                <div id="top1">
                    <div class="panel-heading">
                        <h6>商品信息</h6>
                    </div>
                    <div class="panel-body">
                        <div class="col-xs-6 col-sm-6">
                            <img class="img-responsive" src="" data-name="ImgUrl" />
                            <a href="javascript:void(0);" class="btn btn-default">购买</a>
                        </div>
                        <div class="col-xs-6 col-sm-6">
                            <strong>商品名称：</strong>
                            <p data-name="ProductName"></p>
                            <br /> <br />
                            <strong>商品类型：</strong>
                            <p data-name="ProductType"></p>
                            <br /> <br />
                            <strong>保质期：</strong>
                            <p data-name="ExpiredDate"></p>
                            <br /> <br />
                            <strong>生产时间：</strong>
                            <p data-name="ProductTime"></p>
                            <br /> <br />
                            <strong>生产批次：</strong>
                            <p data-name="BatchNo"></p>
                        </div>
                        <div class="col-sm-12 col-xs-12">
                            <button class="btn btn-default col-sm-12 col-sm-12 OnClick Soc"></button>
                        </div>
                        <div class="flag">
                            <div class="col-sm-12 col-sm-12">
                                <span class="title col-sm-12 col-sm-12">
                                    ●详细信息●
                                </span>
                                <hr style="margin-top:5%;border:solid 1px #000000" />
                                <strong class="detail_t">生产设备：</strong><b class="detail_b" data-name="DeviceName"></b>
                                <br /><br />
                                <strong class="detail_t">商品介绍：</strong><b class="detail_b" data-name="Remark"></b>
                            </div>
                            <div class="col-sm-12 col-sm-12">
                                <span class="title col-sm-12 col-sm-12">
                                    ●产品检测信息●
                                </span>
                                <hr style="margin-top:5%;border:solid 1px #000000" />
                                <strong class="detail_t">检测结果：</strong><b class="detail_b" data-name="ProductCheckResult"></b>
                                <br /><br />
                                <img class="img-responsive" src="" data-name="ProductCheckReport" />
                            </div>
                            <div class="col-sm-12 col-sm-12">
                                <span class="title col-sm-12 col-sm-12">
                                    ●原料检测信息●
                                </span>
                                <hr style="margin-top:5%;border:solid 1px #000000" />
                                <section></section>
                            </div>
                            <div class="Content_Grow">
                                <div class="col-sm-12 col-sm-12">
                                    <span class="title col-sm-12 col-sm-12">
                                        ●成长日记●
                                    </span>
                                    <hr style="margin-top:5%;border:solid 1px #000000" />
                                    <strong class="detail_t">育苗名称：</strong><b class="detail_b" data-name="GrowName"></b>
                                    <br /><br />
                                    <strong class="detail_t">种植时间：</strong><b class="detail_b" data-name="PlantTime"></b>
                                </div>
                                <div class="col-sm-12 col-sm-12">
                                    <span class="title col-sm-12 col-sm-12">
                                        ●相关证书●
                                    </span>
                                    <hr style="border:solid 1px #808080" />
                                    <img class="img-responsive" src="" data-name="Paper" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="top2" class="hidden">
                    <div class="panel-heading">
                        <h6>防伪信息</h6>
                    </div>
                    <div class="panel-body">
                        <div class="col-xs-6 col-sm-6">
                            <img class="img-responsive" src="http://pic34.photophoto.cn/20150103/0030015284991808_b.jpg" />
                        </div>
                        <div class="col-xs-6 col-sm-6">
                            <strong>标签信息：</strong>
                            <p>1</p>
                            <br /> <br />
                            <strong>标签信息：</strong>
                            <p>2</p>
                            <br /> <br />
                            <strong>标签信息：</strong>
                            <p>3</p>
                            <br /> <br />
                            <strong>标签信息：</strong>
                            <p>4</p>
                            <br /> <br />
                            <strong>标签信息：</strong>
                            <p>5</p>
                        </div>
                        <div class="col-sm-12 col-xs-12">
                            <button class="btn btn-default col-sm-12 col-sm-12 OnClick Soc"></button>
                        </div>
                        <div class="flag">
                            <div class="col-sm-12 col-sm-12">
                                <span class="title col-sm-12 col-sm-12">
                                    ●详细信息●
                                </span>
                                <hr style="margin-top:5%;border:solid 1px #000000" />
                                <strong class="detail_t">标签信息：</strong><b class="detail_b">1</b>
                                <br /><br />
                                <strong class="detail_t">标签信息：</strong><b class="detail_b">2</b>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="top3" class="hidden">
                    <div class="panel-heading">
                        <h6>储运信息</h6>
                    </div>
                    <div class="panel-body">
                        <div class="col-sm-12 col-sm-12">
                            <span class="title col-sm-12 col-sm-12">
                                ●详细信息●
                            </span>
                            <hr style="margin-top:5%;border:solid 1px #000000" />
                            <strong class="detail_t">运单号：</strong><b class="detail_b" data-name="WayBill"></b>
                            <br /><br />
                            <strong class="detail_t">包装编号：</strong><b class="detail_b" data-name="PackageNo"></b>
                            <br /><br />
                            <strong class="detail_t">运输方式：</strong><b class="detail_b" data-name="TransportWay"></b>
                            <br /><br />
                            <strong class="detail_t">运输工具：</strong><b class="detail_b" data-name="Traffic"></b>
                            <br /><br />
                            <strong class="detail_t">出库批次：</strong><b class="detail_b" data-name="OutStockBatchNo"></b>
                            <br /><br />
                            <strong class="detail_t">运输地址：</strong><b class="detail_b" data-name="Address"></b>
                        </div>
                    </div>
                </div>
                <div id="top4" class="hidden">
                    <div class="panel-heading">
                        <h6>企业信息</h6>
                    </div>
                    <div class="panel-body">
                        <div class="col-xs-6 col-sm-6">
                            <img class="img-responsive" src="" data-name="ImgUrl" />
                        </div>
                        <div class="col-xs-6 col-sm-6">
                            <strong>企业名称：</strong>
                            <p data-name="CompanyName"></p>
                            <br /><br /><br /><br /><br /><br />
                            <strong>企业网站：</strong>
                            <p data-name="NetAddress"></p>
                            <br /><br /><br /><br /><br /><br />
                            <strong>企业地址：</strong>
                            <p data-name="CompanyAddress"></p>
                        </div>
                        <div class="col-sm-12 col-sm-12">
                            <span class="title col-sm-12 col-sm-12">
                                ●企业介绍●
                            </span>
                            <hr style="margin-top:5%;border:solid 1px #000000" />
                            <b class="detail_b" data-name="Discription"></b>
                            <span class="title col-sm-12 col-sm-12">
                                ●企业地图●
                            </span>
                            <hr style="margin-top:5%;border:solid 1px #000000" />
                            <div style="max-width:100%;height:500px;" id="Map"></div>
                        </div>
                    </div>
                </div>
                <div id="top5" class="hidden">
                    <div class="panel-heading">
                        <h6>监管信息</h6>
                    </div>
                    <div class="panel-body">
                        <div class="col-sm-12 col-sm-12">
                            <span class="title col-sm-12 col-sm-12">
                                ●详细信息●
                            </span>
                            <hr style="margin-top:5%;border:solid 1px #000000" />
                            <strong class="detail_t">检查次数：</strong><b class="detail_b" data-name="PotrolNum"></b>
                            <br /><br />
                            <strong class="detail_t">通报次数：</strong><b class="detail_b" data-name="BulletinNum"></b>
                            <br /><br />
                            <strong class="detail_t">投诉次数：</strong><b class="detail_b" data-name="Complain"></b>
                            <br /><br />
                            <strong class="detail_t">召回信息：</strong><b class="detail_b" data-name="Traffic"></b>
                        </div>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="feed-back">
                        <img src="Style/ScanDetailImg/Back.png" />
                    </div>
                    <div class="info">
                        <span class="btn btn-default" style="background-image:url(Style/ScanDetailImg/ProductInfo.png);background-repeat:no-repeat" data-selector="#top1"></span>
                        <span class="btn btn-default" style="background-image:url(Style/ScanDetailImg/Validate.png);background-repeat:no-repeat" data-selector="#top2"></span>
                        <span class="btn btn-default" style="background-image:url(Style/ScanDetailImg/Transport.png);background-repeat:no-repeat" data-selector="#top3"></span>
                        <span class="btn btn-default" style="background-image:url(Style/ScanDetailImg/Company.png);background-repeat:no-repeat" data-selector="#top4"></span>
                        <span class="btn btn-default" style="background-image:url(Style/ScanDetailImg/Govt.png);background-repeat:no-repeat" data-selector="#top5"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div style="display:none" id="Edit">
        <form action="http://localhost:50039/api/GovtWeb/EditComplain" method="post">
            <input type="hidden" name="TypePath" />
            <input type="hidden" name="TimeSpan" />
            <input type="hidden" name="CompanyType" />
            <input type="hidden" name="CompanyId" />
            <input type="hidden" name="CompanyName" />
            <input type="hidden" name="ProductName" />
            <div class="input-group">
                <span class="input-group-addon">投诉人</span>
                <input name="ComplainUser" class="form-control" type="text" />
            </div>
            <div class="input-group">
                <span class="input-group-addon">投诉人电话</span>
                <input name="ComplainUserPhone" class="form-control" type="text" />
            </div>
            <textarea name="ComplainContent" class="form-control" rows="3" maxlength="300" placeholder="投诉内容"></textarea>
        </form>
    </div>
    <script>
        //初始化
        var option = {
            Init: function () {
                option.InitDom();
                option.InitEvent();
                option.InitPosition();
            },
            InitDom: function () {
                $.ajax({
                    url: "http://localhost:50039/api/EnterpriseWeb/GetScanCodeDetail",
                    type: "get",
                    dataType: "json",
                    data: { TimeSpan: new Date().getTime(), Id: option.GetParam("Id"), Parameter: option.GetParam("Code") },
                    async: false,
                    success: function (result) {
                        option.BindNode(".content", result.data);
                        option.BindSourceCheck(result.data.Materials);
                        option.BindInput("#Edit", result.data);
                        option.BindRecoverInfo(result.data.RecoverInfo);
                        option.BaiduMap(result.data.LngAndLat);
                    }
                });
            },
            InitEvent: function () {
                $(".Soc").on("click", function () {
                    if ($(this).hasClass("OnClick")) {
                        $(this).removeClass("OnClick").addClass("NorClick");
                        $(".flag").fadeOut(1000);
                    }
                    else {
                        $(this).removeClass("NorClick").addClass("OnClick");
                        $(".flag").fadeIn(1000);
                    }
                });
                $("span", $(".info")).on('click', function () {
                    $($(this).data().selector).removeClass("hidden").addClass("show");
                    for (var i = 0; i < $(this).siblings().length; i++) {
                        $($($(this).siblings()[i]).data().selector).removeClass("show").addClass("hidden");
                    }
                });
                $(".feed-back").on('click', function () {
                    $("input[name='TimeSpan']").val(new Date().getTime());
                    layer.open({
                        type: 1,
                        title: '意见投诉',
                        btn: ['确定', '取消'],
                        area: ['70%', 'auto'],
                        fixed: true,
                        resize: true,
                        maxmin: true,
                        content: $("#Edit").html(),
                        yes: function (index, data) {
                            $.ajax({
                                url: $(data).find("form").attr("action"),
                                type: $(data).find("form").attr("method"),
                                dataType: "json",
                                async: false,
                                data: $(data).find("form").SerializeJson(),
                                success: function (result) {
                                    layer.msg(result.msg);
                                    setTimeout(function () {
                                        layer.closeAll();
                                    }, 500)
                                }
                            })
                        }
                    });
                });
            },
            InitPosition: function () {
                var datas = {
                    TimeSpan: new Date().getTime(),
                    ScanCode: option.GetParam("Code"),
                    ScanAddress: null,
                    ScanIP: returnCitySN.cip,
                    ScanPackageNo: $("[data-name='PackageNo']", $(".content")).text(),
                    ScanGoodsName: $("[data-name='ProductName']", $(".content")).text(),
                };
                $.ajax({
                    url: "http://api.map.baidu.com/location/ip?ak=rEU7BdGnB0kKyIjUiONnUHlw&ip=" + datas.ScanIP + "&coor=bd09ll",
                    async: false,
                    type: "get",
                    dataType: "jsonp",
                    success: function (result) {
                        datas.ScanAddress = result.content.address;
                        option.AppendScanInfo(datas);
                    }
                });
            },
            //追加扫描信息
            AppendScanInfo: function (Param) {
                $.ajax({
                    url: "http://localhost:50039/api/EnterpriseWeb/EditScanInfo",
                    data: Param,
                    dataType: "json",
                    type: "post",
                    async: false,
                    success: function (result) {}
                });
            },
            GetParam: function (Param) {
                var reg = new RegExp("(^|&)" + Param + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
                var r = window.location.search.substr(1).match(reg);  //匹配目标参数
                if (r != null) return decodeURI(r[2]); return null; //返回参数值
            },
            BindNode: function (Element, Param) {
                for (var key in Param) {
                    var node = $("[data-name='" + key + "']", $(Element));
                    var value = Param[key];
                    if (node.attr("src") != undefined)
                        node.attr("src", value);
                    node.text(value);
                }
            },
            BindInput: function (Element, Param) {
                for (var key in Param) {
                    var node = $("[name='" + key + "']", $(Element));
                    var value = Param[key];
                    node.val(value);
                }
            },
            BaiduMap: function (Param) {
                if (Param == null)
                    return;
                var Map = new BMap.Map("Map");//在百度地图容器中创建一个地图
                var Point = new BMap.Point(Param.split(",")[0], Param.split(",")[1]);//定义一个中心点坐标
                var Marker = new BMap.Marker(Point);//设置点
                Map.addOverlay(Marker);//添加点到地图中
                Map.enableDragging();//启用地图拖拽事件，默认启用(可不写)
                Map.enableScrollWheelZoom();//启用地图滚轮放大缩小
                Map.enableDoubleClickZoom();//启用鼠标双击放大，默认启用(可不写)
                Map.enableKeyboard();//启用键盘上下左右键移动地图
                Map.centerAndZoom(Point, 15);//设定地图的中心点和坐标并将地图显示在地图容器中
            },
            BindSourceCheck: function (Param) {
                if (Param == null)
                    return;
                var html = '';
                $.each(Param, function (i, data) {
                    html += '<strong class="detail_t">原料名称：</strong><b class="detail_b">' + data.MaterName + '</b><br /><br />';
                    html += '<strong class="detail_t">供应商：</strong><b class="detail_b">' + data.Supplier + '</b><br /><br />';
                    html += '<strong class="detail_t">检测结果：</strong><b class="detail_b">' + data.MaterCheckResult + '</b><br /><br />'
                    html += '<img class="img-responsive" src="' + data.MaterCheckReport + '" />';
                });
                $("section").html(html);
            },
            BindRecoverInfo: function (Param) {
                controller.CheckFeild(Param) ? "召回时间:" + Param.RecoverStarTime + "-" + RecoverEndTime + ";召回数量:" + Param.RecoverNum: "无召回信息";
            }
        };
        $(document).ready(function () {
            option.Init();
        });
    </script>
</body>
</html>

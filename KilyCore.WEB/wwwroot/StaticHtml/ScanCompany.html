<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>企业信息</title>
    <link rel="icon" type="image/x-icon" href="StaticImg/logo.ico" />
    <link href="Style/ScanCompany.css" rel="stylesheet" />
    <link href="../Content/BootStrap/Css/bootstrap.css" rel="stylesheet" />
    <script src="../Content/JavaScript/jquery.min.js"></script>
    <script src="../Content/BootStrap/Script/bootstrap.js"></script>
    <script src="../Content/JavaScript/jquery.extension.js"></script>
    <script src="../Content/Layer/layer.js"></script>
    <style>
        .form-control {
            height: 80px;
            font-size: 30px;
        }
    </style>
</head>
<body>
    <div class="row">
        <div class=" col-sm-12 col-xs-12 head">
            <img src="Style/ScanDetailImg/Logo.png" class="pull-left">
            <h1>中食药监管信息查询平台</h1>
        </div>
    </div>
    <div class="row">
        <div class="content">
            <div class="panel panel-default">
                <div>
                    <div class="panel-heading">
                        <h6>企业信息</h6>
                    </div>
                    <div class="panel-body">
                        <div class="col-xs-6 col-sm-6">
                            <img class="img-responsive" src="" data-name="Certification" title="营业执照" />
                        </div>
                        <div class="col-xs-6 col-sm-6">
                            <strong>企业名称：</strong>
                            <p data-name="CompanyName"></p>
                            <br /> <br />
                            <strong>企业类型：</strong>
                            <p data-name="CompanyTypeName"></p>
                            <br /> <br />
                            <strong>企业性质：</strong>
                            <p data-name="NatureName"></p>
                            <br /> <br />
                            <strong>企业地址：</strong>
                            <p data-name="CompanyAddress"></p>
                            <br /> <br />
                            <strong>工商代码：</strong>
                            <p data-name="CommunityCode"></p>
                        </div>
                        <div>
                            <div class="col-sm-12 col-sm-12">
                                <span class="title col-sm-12 col-sm-12">●详细信息●</span>
                                <hr style="margin-top:5%;border:solid 1px #000000" />
                                <strong class="detail_t">企业网站：</strong><b class="detail_b" data-name="NetAddress"></b>
                                <br /><br />
                                <strong class="detail_t">销售地址：</strong><b class="detail_b" data-name="SellerAddress"></b>
                                <br /><br />
                                <strong class="detail_t">生产地址：</strong><b class="detail_b" data-name="ProductionAddress"></b>
                                <br /><br />
                                <strong class="detail_t">经营范围：</strong><b class="detail_b" data-name="Scope"></b>
                                <br /><br />
                                <strong class="detail_t">企业介绍：</strong><b class="detail_b" data-name="Discription"></b>
                            </div>
                            <div class="col-sm-12 col-sm-12">
                                <span class="title col-sm-12 col-sm-12">●荣誉证书●</span>
                                <hr style="margin-top:5%;border:solid 1px #000000" />
                                <div id="ImgContent">
                                </div>
                            </div>
                        </div>
                        <span class="title col-sm-12 col-sm-12" id="ComplainCom">●企业投诉●</span>
                        <div class="Report" id="ReContent">
                            <br />
                            <form method="post" action="http://localhost:50039/api/GovtWeb/EditComplain" id="Complain">
                                <input type="hidden" name="CompanyId" />
                                <input type="hidden" name="CompanyType" />
                                <input type="hidden" name="CompanyName" />
                                <input type="hidden" name="TypePath" />
                                <input type="hidden" name="TimeSpan" />
                                <table class="table table-hover table-bordered">
                                    <tr>
                                        <td class="has-warning" colspan="4">
                                            <input type="text" name="ComplainUser" class="form-control" placeholder="请输入投诉人" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="has-warning" colspan="4">
                                            <input type="text" name="ComplainUserPhone" class="form-control" placeholder="请输入投诉人电话" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="has-warning" colspan="4">
                                            <textarea type="text" name="ComplainContent" class="form-control" rows="5" maxlength="500" placeholder="请输入投诉内容"></textarea>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th colspan="2" style="text-align:center;vertical-align:middle;font-size:34px;">
                                            <button class="btn btn-danger btn-lg" type="button" id="Enter" style="font-size:30px;">提交</button>
                                        </th>
                                        <th colspan="2" style="text-align:center;vertical-align:middle;font-size:34px;">
                                            <button class="btn btn-danger btn-lg" type="button" id="Cancel" style="font-size:30px;">取消</button>
                                        </th>
                                    </tr>
                                </table>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        //初始化
        var option = {
            Init: function () {
                option.InitDom();
                option.InitEvent();
            },
            InitDom: function () {
                $.ajax({
                    url: "http://localhost:50039/api/EnterpriseWeb/GetEnterpriseInfo",
                    type: "post",
                    dataType: "json",
                    data: { TimeSpan: new Date().getTime(), Id: option.GetParam("Id")},
                    async: false,
                    success: function (result) {
                        option.BindNode(".content", result.data);
                        option.BindHonor("#ImgContent", result.data.HonorCertification);
                        $("input[type='hidden'][name='CompanyId']").val(result.data.Id); 
                        $("input[type='hidden'][name='CompanyType']").val(result.data.CompanyTypeName);
                        $("input[type='hidden'][name='CompanyName']").val(result.data.CompanyName);
                        $("input[type='hidden'][name='TypePath']").val(result.data.TypePath);
                    }
                });
            },
            InitEvent: function () {
                $("#ComplainCom").on("click", function () {
                    $("#ReContent").removeClass("Report");
                });
                $("#Cancel").on('click', function () {
                    $("#Complain").find("input:text,textarea").each(function () {
                        $(this).val("");
                    });
                    $("#ReContent").addClass("Report");
                });
                $("#Enter").on("click", function () {
                    $("input[type='hidden'][name='TimeSpan']").val(new Date().getTime());
                    $.ajax({
                        url: $("#Complain").attr("action"),
                        type: $("#Complain").attr("method"),
                        data: $("#Complain").SerializeJson(),
                        async: false,
                        success: function (res) {
                            alert(res.msg);
                            $("#Cancel").click();
                        }
                    });
                });
            },
            GetParam: function (Param) {
                var reg = new RegExp("(^|&)" + Param + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
                var r = window.location.search.substr(1).match(reg);  //匹配目标参数
                if (r != null) return decodeURI(r[2]); return null; //返回参数值
            },
            BindNode: function (Element, Param) {
                for (var key in Param) {
                    var node = $("[data-name='" + key + "']", $(Element));
                    var value = Param[key];
                    if (node.attr("src") != undefined)
                        node.attr("src", value);
                    node.text(value);
                }
            },
            BindHonor: function (Element, Param) {
                var html = '';
                $.each(Param, function (i, data) {
                    html += '<img src="' + data + '" class="img-responsive" /><br/><br/>';
                });
                $(Element).html(html);
            },
        };
        $(document).ready(function () {
            option.Init();
        });
    </script>
</body>
</html>